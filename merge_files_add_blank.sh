#!/usr/bin/env bash
#==============================================================================
# 脚本名: merge_files_add_blank.sh
# 功能:  将多个文件内容合并，并在每个文件结尾追加一个空行
# 作者:  adolf1
# 邮箱:  wangjyafk@126.com
# 创建:  2025-06-01
# 更新:  2025-06-10  adolf1  增加 xxx 功能
# 依赖:  bash≥4.0
# 用法:  ./merge_files_add_blank.sh 输出文件 文件1 文件2 [文件3 ...]
# 示例： ./merge_files_add_blank.sh merged.txt *.txt
# 系统： Unix / macOS / Linux 通用
# 仓库:  https://github.com/AdolfFK/script_library
#==============================================================================
set -euo pipefail

output_file="$1"
shift   # 移除第一个参数，剩下均为待合并文件

# 如果输出文件已存在则备份
[[ -f "$output_file" ]] && mv "$output_file" "${output_file}.bak"

#----------------------------------------------------
# 方法 1：awk
#----------------------------------------------------
# awk 'FNR==1 && NR!=1 {print ""} {print}' "$@" > "$output_file"

#----------------------------------------------------
# 方法 2：sed
#----------------------------------------------------
# sed '$a\' "$@" > "$output_file"

#----------------------------------------------------
# 方法 3：cat + echo（默认启用，最兼容）
#----------------------------------------------------
for file in "$@"; do
    [[ -f "$file" ]] || { echo "警告：跳过不存在文件 $file"; continue; }
    cat "$file"
    echo ""   # 每个文件后插入空行
done > "$output_file"

#----------------------------------------------------
# 方法 4：find + xargs（适用于递归目录）
#----------------------------------------------------
# find . -name '*.txt' | xargs -I {} sh -c 'cat "{}"; echo ""' > "$output_file"

echo "合并完成 → $output_file"
